@startuml Deployment_Diagram
!theme plain

title ESP32 Stepper Motor Controller - Deployment View

' Define nodes with hardware components
node "ESP32 Development Board" as ESP32 {
    
    ' Software components running on ESP32
    artifact "main.c" as MainApp
    artifact "stepper_motor" as StepperComp
    artifact "ble_peripheral" as BLEComp  
    artifact "motor_testing" as TestComp
    artifact "common" as CommonComp
    
    ' ESP-IDF Framework
    artifact "ESP-IDF Framework" as Framework
    artifact "FreeRTOS" as RTOS
    
    ' Hardware interfaces
    interface "GPIO Pins" as GPIO
    interface "BLE Radio" as BLERadio
    interface "UART" as UART
    
    MainApp --> StepperComp
    MainApp --> BLEComp
    MainApp --> TestComp
    MainApp --> CommonComp
    
    StepperComp --> Framework
    BLEComp --> Framework  
    TestComp --> Framework
    
    Framework --> RTOS
    Framework --> GPIO
    Framework --> BLERadio
    Framework --> UART
}

' External hardware components
node "DRV8833 Motor Driver" as DriverBoard {
    interface "Control Pins" as ControlPins
    interface "Motor Outputs" as MotorOut
    interface "Power Input" as PowerIn
    
    ControlPins : AIN1, AIN2
    ControlPins : BIN1, BIN2  
    ControlPins : SLEEP, FAULT
}

node "Stepper Motor" as Motor {
    interface "Phase Connections" as PhaseConn
    PhaseConn : Phase A (Blue/Black)
    PhaseConn : Phase B (Red/Yellow)
}

node "Status LEDs" as LEDs {
    interface "LED Connections" as LEDConn
    LEDConn : LED1 - Motor Activity
    LEDConn : LED2 - Enable Status
    LEDConn : LED3 - Home Command
    LEDConn : LED4 - Stop Command
}

node "Power Supply" as PSU {
    interface "5V Output" as Power5V
    interface "3.3V Output" as Power33V
}

' Mobile device
node "Mobile Device" as Mobile {
    artifact "BLE Client App" as MobileApp
    interface "Bluetooth LE" as MobileBLE
    
    MobileApp --> MobileBLE
}

node "Development PC" as PC {
    artifact "ESP-IDF Tools" as IDFTools
    artifact "Serial Monitor" as SerialMon
    interface "USB" as USB
    
    IDFTools --> USB
    SerialMon --> USB
}

' Physical connections
GPIO --> ControlPins : "6 digital pins\nGPIO 26,27,14,12,13,25"
GPIO --> LEDConn : "4 digital pins\nGPIO 2,4,5,18"
ControlPins --> MotorOut : "H-bridge control"
MotorOut --> PhaseConn : "Phase A & B signals"

' Wireless connections  
BLERadio -.-> MobileBLE : "Wireless\nBLE 4.2+"
UART -.-> USB : "Serial Debug\n115200 baud"

' Power connections
Power5V --> PowerIn : "Motor power"
Power33V --> ESP32 : "Logic power"
Power33V --> LEDs : "LED power"

' Deployment notes
note right of ESP32 : Runs FreeRTOS\nMultiple tasks:\n- Motor control\n- BLE management\n- System monitoring
note right of DriverBoard : H-bridge motor driver\nUp to 2A per channel\nThermal protection
note right of Motor : 2-phase bipolar\n200 steps/revolution\n1.8Â° step angle
note right of Mobile : iOS/Android app\nReal-time control\nStatus monitoring

' GPIO pin mapping
note bottom of GPIO : Pin Mapping:\nAIN1=26, AIN2=27\nBIN1=14, BIN2=12\nSLEEP=13, FAULT=25\nLED1=2, LED2=4\nLED3=5, LED4=18

@enduml 